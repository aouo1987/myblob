[TOC]





### _mysql的安装和设置_

```shell

mysql下载
     wget http://dev.mysql.com/get/Downloads/MySQL-5.6/mysql-5.6.33-linux-glibc2.5-x86_64.tar.gz
解压
    //解压文件并放置到指定的文件目录
    tar -xzvf mysql-5.6.33-linux-glibc2.5-x86_64.tar.gz
添加用户组和用户
    //添加用户组
    groupadd mysql
    //添加用户组mysql到用户组mysql
    useradd -g mysql mysql
安装mysql
	[root@master ~]# mkdir -p /usr/local/mysql
	//复制解压后的mysql的文件夹
    cp -r mysql-5.6.33-linux-glibc2.5-x86_64 /usr/local/mysql
    //切换到mysql的文件目录下
    [root@master mysql]# pwd
		/usr/local/mysql
	[root@master mysql]# mkdir data
	-- 修改当前data目录用户和用户组信息 --
	[root@master mysql]# chown -R mysql:mysql .
	[root@master mysql]# ll
	总用量 68
    drwxr-xr-x.  2 mysql mysql  4096 1月  16 19:28 bin
    -rw-r--r--.  1 mysql mysql 17987 1月  16 19:27 COPYING
    drwxr-xr-x.  5 mysql mysql  4096 1月  16 19:40 data
    drwxr-xr-x.  2 mysql mysql  4096 1月  16 19:28 docs
    drwxr-xr-x.  3 mysql mysql  4096 1月  16 19:28 include
    drwxr-xr-x.  3 mysql mysql  4096 1月  16 19:28 lib
    drwxr-xr-x.  4 mysql mysql  4096 1月  16 19:28 man
    -rw-r--r--.  1 mysql mysql   943 1月  16 19:31 my.cnf
    -rw-r--r--.  1 mysql mysql   943 1月  16 19:32 my-new.cnf
    drwxr-xr-x. 10 mysql mysql  4096 1月  16 19:28 mysql-test
    -rw-r--r--.  1 mysql mysql  2496 1月  16 19:27 README
    drwxr-xr-x.  2 mysql mysql  4096 1月  16 19:28 scripts
    drwxr-xr-x. 28 mysql mysql  4096 1月  16 19:28 share
    drwxr-xr-x.  4 mysql mysql  4096 1月  16 19:28 sql-bench
    drwxr-xr-x.  2 mysql mysql  4096 1月  16 19:28 support-files

	--初始化数据--
    ./scripts/mysql_install_db --user=mysql --datadir=/usr/local/mysql/data
    --复制配置文件到/etc/my.cnf --
    cp support-files/my-default.cnf /etc/my.cnf
    --mysql的服务脚本方法系统服务中--
    cp support-files/mysql.server /etc/init.d/mysqld
    chmod 755 /etc/init.d/mysqld
    
 修改my.conf文件
 	[root@master mysql]# cat /etc/my.cnf 
    # For advice on how to change settings please see
    # http://dev.mysql.com/doc/refman/5.6/en/server-configuration-defaults.html
    # *** DO NOT EDIT THIS FILE. It's a template which will be copied to the
    # *** default location during install, and will be replaced if you
    # *** upgrade to a newer version of MySQL.
    [mysqld]  和服务名称一致
    # Remove leading # and set to the amount of RAM for the most important data
    # cache in MySQL. Start at 70% of total RAM for dedicated server, else 10%.
    # innodb_buffer_pool_size = 128M
    # Remove leading # to turn on a very important data integrity option: logging
    # changes to the binary log between backups.
    # log_bin
    # These are commonly set, remove the # and set as required.
     basedir=/usr/local/mysql
     datadir=/usr/local/mysql/data 
     port=3306
    # server_id = .....
     socket=/tmp/mysql.sock
     character-set-server=utf8mb4

    # Remove leading # to set options mainly useful for reporting servers.
    # The server defaults are faster for transactions and fast SELECTs.
    # Adjust sizes as needed, experiment to find the optimal values.
    # join_buffer_size = 128M
    # sort_buffer_size = 2M
    # read_rnd_buffer_size = 2M 
    sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES 
    
    
 修改启动脚本
     vi /etc/init.d/mysqld
     //修改内容如下
     basedir = /usr/local/mysql
     datadir = /usr/local/mysql/data
     
启动,查看和关闭服务
    service mysqld start //启动mysql
    service mysqld stop  //关闭mysql
    service mysqld status //查看mysql的状态
 [root@master mysql]# service mysqld start
	Starting MySQL. SUCCESS! 
 [root@master mysql]# 
   
```

***启动测试***

```sql
[root@master bin]# mysql -u root mysql
mysql> use mysql;
mysql> update user set authentication_string = 'ssgao' where user='root';
Query OK, 4 rows affected (0.00 sec)
Rows matched: 4  Changed: 4  Warnings: 0

远程访问权限
root使用ssgao从任何主机连接到mysql服务器
mysql> grant all privileges on *.* to root@'%' identified by 'ssgao' with grant option;
Query OK, 0 rows affected (0.02 sec)

mysql> flush privileges;
Query OK, 0 rows affected (0.00 sec)

```



```shell
[root@master bin]# schematool -dbType mysql -initSchema
SLF4J: Class path contains multiple SLF4J bindings.
SLF4J: Found binding in [jar:file:/root/software/apache-hive-2.3.4-bin/lib/log4j-slf4j-impl-2.6.2.jar!/org/slf4j/impl/StaticLoggerBinder.class]
SLF4J: Found binding in [jar:file:/root/software/hadoop-2.7.4-cluster/share/hadoop/common/lib/slf4j-log4j12-1.7.10.jar!/org/slf4j/impl/StaticLoggerBinder.class]
SLF4J: See http://www.slf4j.org/codes.html#multiple_bindings for an explanation.
SLF4J: Actual binding is of type [org.apache.logging.slf4j.Log4jLoggerFactory]
Metastore connection URL:	 jdbc:mysql://192.168.10.140:3306/hive?createDatabaseIfNotExist=true&characterEncoding=UTF-8
Metastore Connection Driver :	 com.mysql.jdbc.Driver
Metastore connection User:	 root
org.apache.hadoop.hive.metastore.HiveMetaException: Failed to get schema version.
Underlying cause: java.sql.SQLException : Access denied for user 'root'@'master.ssgao' (using password: YES)
SQL Error code: 1045
Use --verbose for detailed stacktrace.

#vim /etc/my.cnf(注：windows下修改的是my.ini)
在文档内搜索mysqld定位到[mysqld]文本段：
/mysqld(在vim编辑状态下直接输入该命令可搜索文本内容)
在[mysqld]后面任意一行添加(skip-grant-tables)用来跳过密码验证的过程
```





#### _安装问题记录_

```shell
常见的错误信息
 [root@ssgao mysql_tar]# service mysqld start
 /etc/init.d/mysqld: line 256: my_print_defaults: command not found
 Starting MySQL ERROR! Couldn't find MySQL server (/usr/local/mysql/bin/mysqld_safe)
     
```

```sql
[root@master mysql]# ./scripts/mysql_install_db --user=mysql --datadir=/usr/local/mysql/data/
Installing MySQL system tables..../bin/mysqld: error while loading shared libraries: libaio.so.1: cannot open shared object file: No such file or directory

解决方法:[root@master mysql]# yum -y install libaio-devel

```



***远程访问的问题***

```sql
注意mysql的my.conf的配置文件中添加"skip-grant-tables"

mysql> grant all privileges on *.* to root@'%' identified by 'ssgao' ;
ERROR 1290 (HY000): The MySQL server is running with the --skip-grant-tables option so it cannot execute this statement
mysql> 
mysql> 
mysql> flush privileges;
Query OK, 0 rows affected (0.00 sec)

mysql> grant all privileges on *.* to root@'%' identified by 'ssgao' ;
Query OK, 0 rows affected (0.00 sec)
```





#### _mysql 启动命令_

```sql

```





### _mysql命令_

#### _mysql 数据库操作_

```sql
create [database|schema] [if not exists] db_name [create_specification];
mysql> create database if not exists hive;
Query OK, 1 row affected (0.00 sec)

mysql> show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| hive               |
| mysql              |
| performance_schema |
| test               |
+--------------------+
5 rows in set (0.00 sec)

```









### _mysql语句_

#### _group by_

```sql
group by 意思是将所有具有相同X字段值的记录放到一个分组中,即以X字段进行分组; 那么group by x,y 意思就是将所有相同字段x和字段y的值放在一个分组里也就是以字段x和字段y进行分组。
group by 一般是和聚合函数一起使用,例如count,sum,avg等,使用group by的两个要素
1) 出现在select后面的字段,要么是聚合函数,要么是group by中的字段
	select subject,semester,count(*) from subject_selection group by subject,semester;
2） 要筛选结果,可以先使用where,再用group by 或者先用group by 再用having。参照如下sql语句执行顺序
	select distinct <select_columns> from <left_table> <join_type> <right_table>
		on <join_condition>
		where <where_condition>
		group by <group_by_condition>
		with {cube|rollup}
		having <having_condition>
		order by<order_by_list>
		limit <limit_number>
	
```



#### _group_concat_

```sql
将多行数据合并成一列
mysql> select group_concat(is_https separator ',') from media_detail;
+--------------------------------------+
| group_concat(is_https separator ',') |
+--------------------------------------+
| 1,0,0,0,0,1,0,1,0,0,1,0,1            |
+--------------------------------------+
group_concat() 中值为要我们合并的数据字段名
separator 函数是用来分隔这些要合并的数据
mysql> select group_concat(is_https, ':', deep_link) from media_detail;
+-----------------------------------------------------+
| group_concat(is_https, ':', deep_link)              |
+-----------------------------------------------------+
| 1:0,0:0,0:0,0:0,0:0,1:0,0:0,1:0,0:0,0:0,1:0,0:0,1:0 |
+-----------------------------------------------------+

```





#### _case_when_

```sql
mysql> select distinct  case when ad_type = 1 then '合约广告' when ad_type=2 then '竞价广告'  else 'other' end from ad_form;
+------------------------------------------------------------------------------------------------+
| case when ad_type = 1 then '合约广告' when ad_type=2 then '竞价广告'  else 'other' end         |
+------------------------------------------------------------------------------------------------+
| 竞价广告                                                                                       |
| 合约广告                                                                                       |
+------------------------------------------------------------------------------------------------+

```








### _总结_

